# /speckit.plan 指令最佳实践

## 指令概述

`/speckit.plan` 将技术规范转化为可执行的开发计划，包括时间线、任务分解、资源配置和风险控制。

## 基本用法

### 直接使用（常见方式）

```
@github/copilot /speckit.plan
```

**实际效果**：

- Copilot 会基于当前文件上下文（如规范文档）自动分析并生成开发计划
- 如果上下文不够，会主动询问关键信息（时间、团队、技术栈等）
- 这是最常用的方式，简单直接

### 带描述使用（详细指定）

```
@github/copilot /speckit.plan [详细的计划需求描述]
```

**适用场景**：需要特定约束条件或复杂项目规划时使用

## 使用场景

- 制定项目开发计划和里程碑
- 分解复杂功能为可管理的任务
- 确定开发顺序和依赖关系
- 估算工作量和资源需求

## 实际使用场景

### 直接执行 `/speckit.plan` 的真实情况

**情况 1：在规范文件中使用**
当你在 `spec.md` 或其他技术规范文件中执行 `/speckit.plan` 时：

- ✅ Copilot 自动分析当前规范内容
- ✅ 直接生成相应的开发计划
- ✅ 包含合理的时间估算和任务分解
- ✅ 如有疑问会在计划中标注或询问

**情况 2：在空白文件中使用**

- Copilot 会询问基本信息：项目类型、规模、时间要求
- 然后基于你的回答生成计划框架
- 这种交互式的方式很常见且实用

**情况 3：在项目文件中使用**
如果在已有项目的代码文件中使用：

- Copilot 会分析项目结构和技术栈
- 基于现有代码生成改进或扩展计划

## 最佳实践

### 1. 在规范文件中直接使用（推荐）

**操作步骤**：

1. 打开你的技术规范文件（如 `spec.md`）
2. 直接输入：`@github/copilot /speckit.plan`
3. Copilot 自动分析规范内容，生成开发计划

**优势**：

- 无需重复描述功能需求
- 计划与规范保持一致
- 自动识别技术复杂度

### 2. 利用上下文智能生成

当你直接使用 `/speckit.plan` 时，Copilot 会：

- 分析当前文件的技术内容
- 理解项目的复杂程度
- 推断合适的开发周期
- 生成符合实际的任务分解

## 真实案例示例

### 案例 1：用户认证系统开发计划

**输入**：

```
@github/copilot /speckit.plan 用户认证系统4周开发计划：
- 团队：2后端 + 1前端 + 1测试
- 功能：注册登录、JWT认证、第三方登录
- 要求：安全性测试、性能优化
```

**输出示例**：

```markdown
# 用户认证系统开发计划

## 项目概况

- **周期**: 4 周
- **团队**: 2 后端 + 1 前端 + 1 测试工程师
- **技术栈**: Node.js + React + PostgreSQL + JWT

## 开发计划

### Week 1: 基础架构

**目标**: 搭建开发环境和数据模型

**任务分解**:
```

后端工程师 A (3 天):

- [ ] 数据库设计和搭建
- [ ] 用户模型和基础 API
- [ ] JWT 认证中间件

后端工程师 B (3 天):

- [ ] 开发环境配置
- [ ] 邮件服务集成
- [ ] 密码加密和验证

前端工程师 (3 天):

- [ ] 项目初始化和路由
- [ ] 登录注册页面 UI
- [ ] 表单验证组件

```

**交付物**: 基础API + 登录页面原型

### Week 2: 核心功能
**目标**: 完成注册登录核心流程

**任务分解**:
```

后端 (5 天):

- [ ] 用户注册 API (含邮箱验证)
- [ ] 登录 API 和 token 管理
- [ ] 密码重置功能
- [ ] 账户锁定机制

前端 (5 天):

- [ ] 注册登录表单实现
- [ ] Token 存储和自动刷新
- [ ] 用户状态管理
- [ ] 错误处理和提示

```

**风险点**: 邮箱验证延迟问题
**缓解**: 实施异步队列处理

### Week 3: 高级功能
**目标**: 第三方登录和安全加固

**任务分解**:
```

后端 (5 天):

- [ ] Google OAuth 集成
- [ ] GitHub 登录集成
- [ ] 安全日志记录
- [ ] API 限流实现

前端 (5 天):

- [ ] 第三方登录按钮
- [ ] 账户绑定页面
- [ ] 用户中心完善
- [ ] 响应式适配

```

### Week 4: 测试与部署
**目标**: 完整测试和生产部署

**任务分解**:
```

全体 (5 天):

- [ ] 单元测试 (覆盖率>85%)
- [ ] 集成测试和安全测试
- [ ] 性能测试和优化
- [ ] 生产环境部署
- [ ] 监控和日志配置

```

## 里程碑检查点

- **Week 1**: ✅ 基础架构搭建完成
- **Week 2**: ✅ 核心登录功能可用
- **Week 3**: ✅ 第三方集成完成
- **Week 4**: ✅ 生产环境上线

## 风险管控

**高风险**: 第三方OAuth服务不稳定
**缓解**: 实施多个OAuth提供商，增加降级机制

**中风险**: 安全测试发现漏洞
**缓解**: 提前进行代码安全审查

## 成功标准
- [ ] 注册成功率 > 95%
- [ ] 登录响应时间 < 200ms
- [ ] 安全测试0严重漏洞
- [ ] 测试覆盖率 ≥ 85%
```

### 案例 2：API 重构迁移计划

**输入**：

```
@github/copilot /speckit.plan REST API迁移到GraphQL的8周计划：
- 50个REST接口需要迁移
- 保持向后兼容性
- 团队需要GraphQL培训
- 客户端逐步切换
```

**输出示例**：

```markdown
# REST to GraphQL 迁移计划

## 迁移策略

- **周期**: 8 周
- **策略**: 渐进式并行迁移
- **兼容**: REST 和 GraphQL 共存 6 个月

## 分阶段实施

### Phase 1: 基础建设 (Week 1-2)

**目标**: GraphQL 环境搭建和团队培训

**Week 1**: 环境搭建
```

- [ ] GraphQL 服务器搭建 (Apollo Server)
- [ ] Schema 设计工具链
- [ ] 开发环境配置
- [ ] 基础监控配置

```

**Week 2**: 团队培训
```

- [ ] GraphQL 基础培训 (2 天)
- [ ] Schema 设计最佳实践 (1 天)
- [ ] 前端 Apollo Client 培训 (1 天)
- [ ] 实战练习和答疑 (1 天)

```

### Phase 2: 核心模块迁移 (Week 3-5)

**Week 3**: 用户模块 (12个接口)
```

后端:

- [ ] User Schema 设计
- [ ] 认证解析器实现
- [ ] 用户 CRUD 操作

前端:

- [ ] Apollo Client 集成
- [ ] 用户相关页面改造

```

**Week 4**: 商品模块 (18个接口)
```

- [ ] Product Schema 设计 (复杂度较高)
- [ ] 搜索和筛选优化
- [ ] 商品页面 GraphQL 改造

```

**Week 5**: 订单模块 (15个接口)
```

- [ ] Order Schema 和解析器
- [ ] 支付状态同步优化
- [ ] 订单流程页面改造

```

### Phase 3: 优化和迁移 (Week 6-8)

**Week 6**: 性能优化
```

- [ ] DataLoader 实现 (解决 N+1 问题)
- [ ] 查询复杂度控制
- [ ] 缓存策略优化
- [ ] 响应时间监控

```

**Week 7**: 客户端迁移
```

- [ ] 移动端 Apollo SDK 集成
- [ ] 关键页面迁移测试
- [ ] 性能对比分析

```

**Week 8**: 完成迁移
```

- [ ] 剩余接口迁移
- [ ] 全面测试和验证
- [ ] 文档和培训材料
- [ ] REST API 废弃计划

```

## 技术指标

### 性能目标
- API请求数量减少 60%
- 数据传输量减少 40%
- 查询响应时间 < 100ms

### 迁移进度
- Week 3: 用户模块 100%
- Week 4: 商品模块 100%
- Week 5: 订单模块 100%
- Week 8: 全部迁移完成

## 风险控制

**技术风险**: GraphQL学习曲线
**应对**: 充分培训 + 技术专家指导

**业务风险**: 客户端兼容问题
**应对**: 并行运行 + 分阶段发布

**性能风险**: 复杂查询性能问题
**应对**: 查询深度限制 + 复杂度分析
```

### 案例 3：电商 MVP 开发计划

**输入**：

```
@github/copilot /speckit.plan 电商MVP 3个月开发计划：
- 核心功能：商品浏览、购物车、订单、支付
- 团队：3后端 + 2前端 + 1UI + 1测试
- 技术栈：Next.js + Node.js + PostgreSQL
```

**输出示例**：

```markdown
# 电商平台 MVP 开发计划

## 项目规划

- **周期**: 12 周 (3 个月)
- **团队**: 3 后端 + 2 前端 + 1UI + 1 测试
- **目标**: 完整购买流程的 MVP 产品

## MVP 功能范围

### 核心功能 (Must Have)

- ✅ 商品浏览和搜索
- ✅ 用户注册登录
- ✅ 购物车管理
- ✅ 订单和支付
- ✅ 基础管理后台

### 延后功能 (Nice to Have)

- 商品评论系统
- 优惠券功能
- 库存预警
- 数据分析面板

## 开发时间线

### Sprint 1-2: 基础架构 (Week 1-2)

**交付**: 开发环境 + 数据模型 + 基础页面
```

Week 1:

- [ ] 项目架构设计
- [ ] 数据库建模
- [ ] 前后端脚手架
- [ ] UI 设计规范

Week 2:

- [ ] 用户认证 API
- [ ] 商品基础 API
- [ ] 前端路由和布局
- [ ] 公共组件开发

```

### Sprint 3-4: 核心模块 (Week 3-4)
**交付**: 用户系统 + 商品展示

```

Week 3:

- [ ] 用户注册登录完整流程
- [ ] 商品列表和详情页
- [ ] 商品搜索功能

Week 4:

- [ ] 购物车功能实现
- [ ] 用户个人中心
- [ ] 商品分类浏览

```

### Sprint 5-8: 交易闭环 (Week 5-8)
**交付**: 订单系统 + 支付功能

```

Week 5-6: 订单系统

- [ ] 订单创建和管理
- [ ] 订单状态流转
- [ ] 订单查询和列表

Week 7-8: 支付集成

- [ ] Stripe 支付集成
- [ ] 支付宝支付集成
- [ ] 支付成功页面
- [ ] 支付异常处理

```

### Sprint 9-10: 管理后台 (Week 9-10)
**交付**: 基础运营功能

```

- [ ] 商品管理 CRUD
- [ ] 订单管理功能
- [ ] 用户管理功能
- [ ] 基础数据统计

```

### Sprint 11-12: 测试上线 (Week 11-12)
**交付**: 生产就绪的MVP

```

Week 11: 全面测试

- [ ] 功能测试 + 性能测试
- [ ] 安全测试 + 兼容性测试
- [ ] Bug 修复和优化

Week 12: 部署上线

- [ ] 生产环境配置
- [ ] 数据迁移和初始化
- [ ] 监控告警配置
- [ ] 正式发布和推广

```

## 关键里程碑

- **M1 (Week 2)**: 基础架构完成
- **M2 (Week 4)**: 商品浏览功能完成
- **M3 (Week 8)**: 完整购买流程打通
- **M4 (Week 10)**: 管理后台完成
- **M5 (Week 12)**: MVP产品正式上线

## 技术债务控制

### 代码质量
- 测试覆盖率 > 80%
- Code Review 强制执行
- ESLint + Prettier 代码规范

### 性能指标
- 页面加载时间 < 3秒
- API响应时间 < 500ms
- 支持100并发用户

### 安全要求
- HTTPS全站加密
- SQL注入防护
- XSS攻击防护
- 支付数据加密存储
```

## 输出格式说明

plan 指令生成的核心要素：

1. **项目概况** - 周期、团队、技术栈
2. **阶段规划** - 清晰的时间线和交付目标
3. **任务分解** - 具体任务和负责人
4. **里程碑** - 关键检查点和验收标准
5. **风险控制** - 风险识别和缓解策略

## 使用技巧

1. **输入要具体** - 明确功能范围、团队配置、时间要求
2. **考虑依赖关系** - 识别任务间的先后顺序
3. **预留缓冲时间** - 为风险和变更预留 15-20%时间
4. **设定检查点** - 每 1-2 周设置里程碑验证进度
5. **量化标准** - 用可测量的指标定义成功标准

## 与其他指令配合

- 基于 `/speckit.specify` 的规范制定计划
- 使用 `/speckit.tasks` 进一步细化任务
- 用 `/speckit.clarify` 澄清计划中的模糊点
- 结合 `/speckit.implement` 执行具体开发
